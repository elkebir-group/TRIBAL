
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../tribal/">
      
      
        <link rel="next" href="../lineagetreelist/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>LineageTree - TRIBAL</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="brown" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#b-cell-lineage-tree" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="TRIBAL" class="md-header__button md-logo" aria-label="TRIBAL" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TRIBAL
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              LineageTree
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/elkebir-group/TRIBAL" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../setup/install/" class="md-tabs__link">
          
  
  Usage

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../preprocess/" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="TRIBAL" class="md-nav__button md-logo" aria-label="TRIBAL" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    TRIBAL
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/elkebir-group/TRIBAL" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Usage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Download & Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/package/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Package Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Interface
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocess/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocesssing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base_tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BaseTree
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../clonotype/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clonotype
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tribal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tribal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    LineageTree
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    LineageTree
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree" class="md-nav__link">
    <span class="md-ellipsis">
      LineageTree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.__lt__" class="md-nav__link">
    <span class="md-ellipsis">
      __lt__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.__post_init__" class="md-nav__link">
    <span class="md-ellipsis">
      __post_init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.ancestral_sequence_reconstruction" class="md-nav__link">
    <span class="md-ellipsis">
      ancestral_sequence_reconstruction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.children" class="md-nav__link">
    <span class="md-ellipsis">
      children
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.compute_csr_likelihood" class="md-nav__link">
    <span class="md-ellipsis">
      compute_csr_likelihood
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.draw" class="md-nav__link">
    <span class="md-ellipsis">
      draw
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.get_edge_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      get_edge_dataframe
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.get_id" class="md-nav__link">
    <span class="md-ellipsis">
      get_id
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.get_leafs" class="md-nav__link">
    <span class="md-ellipsis">
      get_leafs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.get_parents" class="md-nav__link">
    <span class="md-ellipsis">
      get_parents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.is_leaf" class="md-nav__link">
    <span class="md-ellipsis">
      is_leaf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.isotype_parsimony" class="md-nav__link">
    <span class="md-ellipsis">
      isotype_parsimony
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.parent" class="md-nav__link">
    <span class="md-ellipsis">
      parent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.postorder_traversal" class="md-nav__link">
    <span class="md-ellipsis">
      postorder_traversal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.preorder_traversal" class="md-nav__link">
    <span class="md-ellipsis">
      preorder_traversal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.refinement" class="md-nav__link">
    <span class="md-ellipsis">
      refinement
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.save_edges" class="md-nav__link">
    <span class="md-ellipsis">
      save_edges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.save_tree" class="md-nav__link">
    <span class="md-ellipsis">
      save_tree
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.to_pickle" class="md-nav__link">
    <span class="md-ellipsis">
      to_pickle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tribal.LineageTree.write" class="md-nav__link">
    <span class="md-ellipsis">
      write
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lineagetreelist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LineageTreeList
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="b-cell-lineage-tree">B cell Lineage Tree<a class="headerlink" href="#b-cell-lineage-tree" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-class">



<a id="tribal.LineageTree"></a>
    <div class="doc doc-contents first">


      <p>A class to model B cell lineage trees.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="tribal.LineageTree.clonotype">clonotype</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the clonotype.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tribal.LineageTree.tree">tree</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="tribal.base_tree.BaseTree" href="../base_tree/#tribal.BaseTree">BaseTree</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rooted tree topology.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tribal.LineageTree.csr_obj">csr_obj</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current CSR likelihood of the Lineage tree (default: 0).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tribal.LineageTree.isotype">isotype</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The isotype labels of the Lineage tree nodes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tribal.LineageTree.shm_obj">shm_obj</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current SHM Parsimony score of the Lineage tree (default: 0).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="tribal.LineageTree.sequences">sequences</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The BCR sequences of the Lineage tree nodes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>A B cell lineage tree is a rooted tree with nodes labeled by BCR sequences (concatenated heavy and light chain) and
isotypes. The somatic hypermutation (SHM) parsimony score is the total number of base substitutions within the sequences, and 
the class switch (CSR) likelihood is the likelihood of the isotype labels given an isotype transition probability matrix.</p>
</details>
              <details class="quote">
                <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="nd">@total_ordering</span>
<span class="k">class</span> <span class="nc">LineageTree</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to model B cell lineage trees.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    clonotype : str</span>
<span class="sd">        The name of the clonotype.</span>
<span class="sd">    tree : BaseTree</span>
<span class="sd">        The rooted tree topology.</span>
<span class="sd">    csr_obj : float </span>
<span class="sd">        The current CSR likelihood of the Lineage tree (default: 0).</span>
<span class="sd">    isotype : dict</span>
<span class="sd">        The isotype labels of the Lineage tree nodes.</span>
<span class="sd">    shm_obj : float </span>
<span class="sd">        The current SHM Parsimony score of the Lineage tree (default: 0).</span>
<span class="sd">    sequences : dict</span>
<span class="sd">        The BCR sequences of the Lineage tree nodes.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A B cell lineage tree is a rooted tree with nodes labeled by BCR sequences (concatenated heavy and light chain) and</span>
<span class="sd">    isotypes. The somatic hypermutation (SHM) parsimony score is the total number of base substitutions within the sequences, and </span>
<span class="sd">    the class switch (CSR) likelihood is the likelihood of the isotype labels given an isotype transition probability matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">clonotype</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">tree</span><span class="p">:</span> <span class="n">BaseTree</span><span class="o">=</span> <span class="kc">None</span>
    <span class="n">csr_obj</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">isotypes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">shm_obj</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sequences</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the objective tuple and root.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objective</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shm_obj</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span>

    <span class="k">def</span> <span class="nf">_validate_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check comparison items is an instance of LineageTree.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">LineageTree</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">item</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Score expected, item got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if two lineage tree items have the same objective score.&quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_item</span><span class="p">(</span><span class="n">__value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective</span> <span class="o">==</span><span class="n">item</span><span class="o">.</span><span class="n">objective</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a LineageTree is less than another.&quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_item</span><span class="p">(</span><span class="n">__value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective</span> <span class="o">&lt;</span><span class="n">item</span><span class="o">.</span><span class="n">objective</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To string method.&quot;&quot;&quot;</span>
        <span class="n">mystr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;B cell lineage tree for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">get_leafs</span><span class="p">())</span><span class="si">}</span><span class="s2"> cells&quot;</span>
        <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Root id: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;# of nodes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">mystr</span> <span class="o">+=</span>  <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Objective</span><span class="se">\n</span><span class="s2">----------</span><span class="se">\n</span><span class="s2">SHM: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shm_obj</span><span class="si">}</span><span class="se">\n</span><span class="s2">CSR: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">mystr</span>

    <span class="k">def</span> <span class="nf">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pickle the B cell lineage tree.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str</span>
<span class="sd">            the path to where the pickled object should be saved,</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_seq_len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_csr_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transmat</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute CSR likelihood of a lineage tree for a given isotype transition probability matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        transmat : numpy.array</span>
<span class="sd">            The isotype transition probability used to compute the CSR likelihood.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            The class switch recombination (CSR) likelihood.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transmat</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">transmat</span><span class="p">)</span>

        <span class="n">iso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">preorder_traversal</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">iso</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">iso</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                    <span class="n">score</span> <span class="o">+=</span> <span class="n">transmat</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid isotypes or tree. </span><span class="se">\</span>
<span class="s2">                             First run isotype parsimony or refinement functions.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span> <span class="o">=</span> <span class="n">score</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span>


    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the internal id of the tree topology. Useful for mapping refined trees back the to the unrefined tree in the parsimony forest.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : int</span>
<span class="sd">            the internal id of the tree topology</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">id</span>

    <span class="k">def</span> <span class="nf">ancestral_sequence_reconstruction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span>
                           <span class="n">alphabet</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> 
                           <span class="n">cost_function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Infer the ancestral BCR sequences of the internal nodes given an alignment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alignment : dict</span>
<span class="sd">            a dictionary with leaf labels and root id as keys and the BCR sequence as value.</span>

<span class="sd">        alphabet : tuple</span>
<span class="sd">            the valid alphabet for BCR sequences, default:  (&quot;A&quot;, &quot;C&quot;, &quot;G&quot;, &quot;T&quot;,&quot;N&quot;, &quot;-&quot;)</span>

<span class="sd">        cost_function : dict|None</span>
<span class="sd">            the cost function for substitution of a single nucleotide base. If None, the </span>
<span class="sd">            standard 0/1 cost function is used for matches and mismatches. If dictionary</span>
<span class="sd">            all pairs of the elements in the alpabet should be be includes in the keys.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Here is an example of how to reconstruct ancestral sequences::</span>

<span class="sd">        ```python  </span>
<span class="sd">            from tribal import clonotypes, LineageTree</span>
<span class="sd">            id = &quot;Clonotype_1036&quot;</span>
<span class="sd">            clonotype = clonotypes[id]</span>
<span class="sd">            forest = clonotype.get_forest()</span>
<span class="sd">            lt = LineageTree(id=id, tree = forest[0])</span>
<span class="sd">            shm_score, sequences = lt.ancestral_sequence_reconstruction(clonotype.alignment)</span>
<span class="sd">            print(lt)</span>
<span class="sd">        ```</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : float</span>
<span class="sd">            a float with the somatic hypermutation (SHM) parsimony score for the lineage tree</span>

<span class="sd">        : dict</span>
<span class="sd">            a dictionary containing the BCR sequence labels of the lineage tree</span>

<span class="sd">        &quot;&quot;&quot;</span>     
        <span class="n">alignment</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">alignment</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">alignment</span><span class="p">}</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">SmallParsimony</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> 
                            <span class="n">alphabet</span><span class="o">=</span> <span class="n">alphabet</span><span class="p">,</span>
                            <span class="n">cost</span> <span class="o">=</span> <span class="n">cost_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shm_obj</span><span class="p">,</span> <span class="n">sequences</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sankoff</span><span class="p">(</span><span class="n">alignment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sequences</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shm_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span>



    <span class="k">def</span> <span class="nf">isotype_parsimony</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isotype_labels</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">transmat</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Infer the isotype of the B cell lineage tree using weighted parsimony.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        isotype_labels : dict</span>
<span class="sd">            a dictionary with leaf labels and root id as keys and isotypes as values.  </span>
<span class="sd">        transmat : numpy.array</span>
<span class="sd">            the isotype transition probability used to compute the CSR likelihood.  </span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Here is an example of how to infer isotypes::</span>

<span class="sd">        ```python</span>
<span class="sd">            from tribal import clonotypes, probabilities, LineageTree</span>

<span class="sd">            id = &quot;Clonotype_1036&quot;</span>
<span class="sd">            clonotype = clonotypes[id]</span>
<span class="sd">            forest = clonotype.get_forest()</span>
<span class="sd">            lt = LineageTree(id=id, tree = forest[0] )</span>
<span class="sd">            csr_likelihood, isotypes = lt.isotype_parsimony(isotype_labels= clonotype.isotypes,</span>
<span class="sd">                                                                        transmat=probabilities )</span>
<span class="sd">            print(lt)</span>
<span class="sd">        ```</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        csr_obj : float</span>
<span class="sd">            a float with the class switch recombination likelihood score for the lineage tree.  </span>
<span class="sd">        isotypes : dict</span>
<span class="sd">            a dictionary containing the isotypes of the lineage tree.  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transmat</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">transmat</span><span class="p">)</span>
        <span class="n">states</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">transmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">SmallParsimony</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="n">states</span><span class="p">,</span><span class="n">cost</span><span class="o">=</span><span class="n">transmat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sankoff</span><span class="p">(</span><span class="n">isotype_labels</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">refinement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isotype_labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">transmat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Solves the most parsimonious tree refinement problem (MPTR).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        isotype_labels : dict</span>
<span class="sd">            A dictionary with leaf labels and root id as keys and isotypes as values.</span>
<span class="sd">        transmat : numpy.array</span>
<span class="sd">            The isotype transition probability used to compute the CSR likelihood.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Here is an example of how to refine a lineage tree:</span>

<span class="sd">        ```python</span>
<span class="sd">        from tribal import clonotypes, probabilities, LineageTree</span>

<span class="sd">        id = &quot;Clonotype_1036&quot;</span>
<span class="sd">        clonotype = clonotypes[id]</span>
<span class="sd">        forest = clonotype.get_forest()</span>
<span class="sd">        lt = LineageTree(id=id, tree=forest[0])</span>
<span class="sd">        csr_likelihood, isotypes = lt.refinement(isotype_labels=clonotype.isotypes, transmat=probabilities)</span>
<span class="sd">        print(lt)</span>
<span class="sd">        ```</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            A float with the class switch recombination likelihood score for the lineage tree.  </span>

<span class="sd">        dict</span>
<span class="sd">            A dictionary containing the isotypes of the lineage tree.  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">transmat</span><span class="p">)</span>
        <span class="n">cg</span> <span class="o">=</span> <span class="n">ConstructGraph</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">isotype_labels</span><span class="p">,</span> <span class="n">root_identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="n">fg</span> <span class="o">=</span> <span class="n">cg</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">)</span>

        <span class="n">st</span> <span class="o">=</span> <span class="n">MPTR</span><span class="p">(</span><span class="n">fg</span><span class="o">.</span><span class="n">G</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                  <span class="n">fg</span><span class="o">.</span><span class="n">find_terminals</span><span class="p">(),</span>
                  <span class="n">fg</span><span class="o">.</span><span class="n">iso_weights</span><span class="p">,</span>
                  <span class="n">fg</span><span class="o">.</span><span class="n">tree_to_graph</span><span class="p">,</span>
                  <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span><span class="p">,</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span> <span class="o">=</span> <span class="n">cg</span><span class="o">.</span><span class="n">decodeTree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">BaseTree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">fname</span><span class="p">,</span>
            <span class="n">isotype_encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">show_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">hide_underscore</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">color_encoding</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">dot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualization of the current B cell lineage tree saves as a png or pdf.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str</span>
<span class="sd">            The filename where the visualization should be saved.  </span>
<span class="sd">        isotype_encoding : list</span>
<span class="sd">            The list of the isotype labels to use.  </span>
<span class="sd">        show_legend : bool</span>
<span class="sd">            Optionally display the legend of the isotype colors (default=True).  </span>
<span class="sd">        show_labels : bool</span>
<span class="sd">            label the nodes by the sequence label</span>
<span class="sd">        hide_underscore : bool</span>
<span class="sd">            internal nodes that undergo refinement will have an underscore and copy number appended</span>
<span class="sd">            to the label. Setting this to true hides the underscore during visualization and retains </span>
<span class="sd">            only the original label.</span>
<span class="sd">        color_encoding : dict, optional</span>
<span class="sd">            optional dictionary that maps isotype encoding to a color, if None, the default</span>
<span class="sd">            color palette is used.</span>
<span class="sd">        dot : bool</span>
<span class="sd">            if the file should be saved as a dot file, otherwise it will be saved</span>
<span class="sd">            as a png or pdf, depending on the file exentsion of fname</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parents</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">DrawTree</span><span class="p">(</span><span class="n">parents</span><span class="p">,</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span><span class="p">,</span>
                    <span class="n">show_legend</span><span class="o">=</span><span class="n">show_legend</span><span class="p">,</span>
                    <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
                    <span class="n">isotype_encoding</span><span class="o">=</span><span class="n">isotype_encoding</span><span class="p">,</span>
                    <span class="n">show_labels</span><span class="o">=</span><span class="n">show_labels</span><span class="p">,</span>
                    <span class="n">hide_underscore</span><span class="o">=</span><span class="n">hide_underscore</span><span class="p">,</span>
                    <span class="n">color_encoding</span><span class="o">=</span><span class="n">color_encoding</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dot</span><span class="p">:</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">save_dot</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">postorder_traversal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform a postorder traversal of the lineage tree.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">postorder_traversal</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">preorder_traversal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform a preorder traversal of the lineage tree.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">preorder_traversal</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify the parent of a specified node.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n: str | int</span>
<span class="sd">            id of query node.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">           the parent of query node n.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identify the set of children of a specified node.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : str</span>
<span class="sd">            ID of the query node.  </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A list of children of node `n`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if node is a leaf.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_leafs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identify the leafset of the lineage tree.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            the leafset of the lineage tree.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">get_leafs</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify the part of each node in the lineage tree.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            a mapping of each node in the lineage tree to its parent node.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">get_parents</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">save_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the parent dictionary of the lineage tree to a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str</span>
<span class="sd">            filename where the file should be saved </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parents</span><span class="p">()</span>
        <span class="n">save_dict</span><span class="p">(</span> <span class="n">parents</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the edge list of a lineage tree to a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str</span>
<span class="sd">            filename to where edge list should be saved </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">save_edges</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_edge_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtain the edge list of the lineage tree as a pandas.DataFrame.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">get_edge_df</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outpath</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">isotype_encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tree_label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the lineage tree data to files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        outpath : str</span>
<span class="sd">            the path to file the files should be written.  </span>
<span class="sd">        isotype_encoding : list, optional</span>
<span class="sd">            the ordered isotype labels  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tree_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tree_label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tree_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tree_label</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">clono_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clonotype</span>
        <span class="k">if</span> <span class="n">isotype_encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">isotypes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">iso</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">iso</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">iso</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">isotype_encoding</span><span class="p">):</span>
                    <span class="n">isotypes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">isotype_encoding</span><span class="p">[</span><span class="n">iso</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">isotypes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">iso</span>
            <span class="n">isotype_encoding</span> <span class="o">=</span> <span class="n">isotype_encoding</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">isotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span>
            <span class="n">isotype_encoding</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outpath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outpath</span><span class="p">)</span>

        <span class="n">write_fasta</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outpath</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">clono_name</span><span class="si">}</span><span class="s2">_sequences</span><span class="si">{</span><span class="n">tree_label</span><span class="si">}</span><span class="s2">.fasta&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">)</span>
        <span class="n">save_dict</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outpath</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">clono_name</span><span class="si">}</span><span class="s2">_isotypes</span><span class="si">{</span><span class="n">tree_label</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span><span class="n">isotypes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_edges</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outpath</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">clono_name</span><span class="si">}</span><span class="s2">_edge_list</span><span class="si">{</span><span class="n">tree_label</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outpath</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">clono_name</span><span class="si">}</span><span class="s2">_tree</span><span class="si">{</span><span class="n">tree_label</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span>
                    <span class="n">isotype_encoding</span><span class="o">=</span><span class="n">isotype_encoding</span><span class="p">,</span>
                    <span class="n">hide_underscore</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">show_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.__eq__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__eq__</span><span class="p">(</span><span class="n">__value</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.__eq__" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Check if two lineage tree items have the same objective score.</p>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if two lineage tree items have the same objective score.&quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_item</span><span class="p">(</span><span class="n">__value</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective</span> <span class="o">==</span><span class="n">item</span><span class="o">.</span><span class="n">objective</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.__lt__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__lt__</span><span class="p">(</span><span class="n">__value</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.__lt__" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Check if a LineageTree is less than another.</p>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a LineageTree is less than another.&quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_item</span><span class="p">(</span><span class="n">__value</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective</span> <span class="o">&lt;</span><span class="n">item</span><span class="o">.</span><span class="n">objective</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.__post_init__" class="doc doc-heading">
            <code class=" language-python"><span class="n">__post_init__</span><span class="p">()</span></code>

<a href="#tribal.LineageTree.__post_init__" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Initialize the objective tuple and root.</p>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the objective tuple and root.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">objective</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shm_obj</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.__str__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__str__</span><span class="p">()</span></code>

<a href="#tribal.LineageTree.__str__" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>To string method.</p>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;To string method.&quot;&quot;&quot;</span>
    <span class="n">mystr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;B cell lineage tree for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">get_leafs</span><span class="p">())</span><span class="si">}</span><span class="s2"> cells&quot;</span>
    <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Root id: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">mystr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;# of nodes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">mystr</span> <span class="o">+=</span>  <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Objective</span><span class="se">\n</span><span class="s2">----------</span><span class="se">\n</span><span class="s2">SHM: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shm_obj</span><span class="si">}</span><span class="se">\n</span><span class="s2">CSR: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">mystr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.ancestral_sequence_reconstruction" class="doc doc-heading">
            <code class=" language-python"><span class="n">ancestral_sequence_reconstruction</span><span class="p">(</span><span class="n">alignment</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">),</span> <span class="n">cost_function</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.ancestral_sequence_reconstruction" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Infer the ancestral BCR sequences of the internal nodes given an alignment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>alignment</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary with leaf labels and root id as keys and the BCR sequence as value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>alphabet</code></td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the valid alphabet for BCR sequences, default:  ("A", "C", "G", "T","N", "-")</p>
              </div>
            </td>
            <td>
                  <code>(&#39;A&#39;, &#39;C&#39;, &#39;G&#39;, &#39;T&#39;, &#39;N&#39;, &#39;-&#39;)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cost_function</code></td>
            <td>
                  <code>dict | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the cost function for substitution of a single nucleotide base. If None, the 
standard 0/1 cost function is used for matches and mismatches. If dictionary
all pairs of the elements in the alpabet should be be includes in the keys.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Here is an example of how to reconstruct ancestral sequences::</p>
<div class="highlight"><pre><span></span><code>    <span class="kn">from</span> <span class="nn">tribal</span> <span class="kn">import</span> <span class="n">clonotypes</span><span class="p">,</span> <span class="n">LineageTree</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;Clonotype_1036&quot;</span>
    <span class="n">clonotype</span> <span class="o">=</span> <span class="n">clonotypes</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
    <span class="n">forest</span> <span class="o">=</span> <span class="n">clonotype</span><span class="o">.</span><span class="n">get_forest</span><span class="p">()</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="n">LineageTree</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">forest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">shm_score</span><span class="p">,</span> <span class="n">sequences</span> <span class="o">=</span> <span class="n">lt</span><span class="o">.</span><span class="n">ancestral_sequence_reconstruction</span><span class="p">(</span><span class="n">clonotype</span><span class="o">.</span><span class="n">alignment</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>
</code></pre></div>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a float with the somatic hypermutation (SHM) parsimony score for the lineage tree</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary containing the BCR sequence labels of the lineage tree</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ancestral_sequence_reconstruction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span>
                       <span class="n">alphabet</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> 
                       <span class="n">cost_function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Infer the ancestral BCR sequences of the internal nodes given an alignment.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    alignment : dict</span>
<span class="sd">        a dictionary with leaf labels and root id as keys and the BCR sequence as value.</span>

<span class="sd">    alphabet : tuple</span>
<span class="sd">        the valid alphabet for BCR sequences, default:  (&quot;A&quot;, &quot;C&quot;, &quot;G&quot;, &quot;T&quot;,&quot;N&quot;, &quot;-&quot;)</span>

<span class="sd">    cost_function : dict|None</span>
<span class="sd">        the cost function for substitution of a single nucleotide base. If None, the </span>
<span class="sd">        standard 0/1 cost function is used for matches and mismatches. If dictionary</span>
<span class="sd">        all pairs of the elements in the alpabet should be be includes in the keys.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Here is an example of how to reconstruct ancestral sequences::</span>

<span class="sd">    ```python  </span>
<span class="sd">        from tribal import clonotypes, LineageTree</span>
<span class="sd">        id = &quot;Clonotype_1036&quot;</span>
<span class="sd">        clonotype = clonotypes[id]</span>
<span class="sd">        forest = clonotype.get_forest()</span>
<span class="sd">        lt = LineageTree(id=id, tree = forest[0])</span>
<span class="sd">        shm_score, sequences = lt.ancestral_sequence_reconstruction(clonotype.alignment)</span>
<span class="sd">        print(lt)</span>
<span class="sd">    ```</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    : float</span>
<span class="sd">        a float with the somatic hypermutation (SHM) parsimony score for the lineage tree</span>

<span class="sd">    : dict</span>
<span class="sd">        a dictionary containing the BCR sequence labels of the lineage tree</span>

<span class="sd">    &quot;&quot;&quot;</span>     
    <span class="n">alignment</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">alignment</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">alignment</span><span class="p">}</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="n">SmallParsimony</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> 
                        <span class="n">alphabet</span><span class="o">=</span> <span class="n">alphabet</span><span class="p">,</span>
                        <span class="n">cost</span> <span class="o">=</span> <span class="n">cost_function</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shm_obj</span><span class="p">,</span> <span class="n">sequences</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sankoff</span><span class="p">(</span><span class="n">alignment</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sequences</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shm_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.children" class="doc doc-heading">
            <code class=" language-python"><span class="n">children</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.children" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Identify the set of children of a specified node.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>n</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the query node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    A list of children of node `n`.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Identify the set of children of a specified node.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : str</span>
<span class="sd">        ID of the query node.  </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        A list of children of node `n`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.compute_csr_likelihood" class="doc doc-heading">
            <code class=" language-python"><span class="n">compute_csr_likelihood</span><span class="p">(</span><span class="n">transmat</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.compute_csr_likelihood" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Compute CSR likelihood of a lineage tree for a given isotype transition probability matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>transmat</code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The isotype transition probability used to compute the CSR likelihood.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    The class switch recombination (CSR) likelihood.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_csr_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transmat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute CSR likelihood of a lineage tree for a given isotype transition probability matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    transmat : numpy.array</span>
<span class="sd">        The isotype transition probability used to compute the CSR likelihood.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        The class switch recombination (CSR) likelihood.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transmat</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">transmat</span><span class="p">)</span>

    <span class="n">iso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span>
    <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">preorder_traversal</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">iso</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">iso</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="n">transmat</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid isotypes or tree. </span><span class="se">\</span>
<span class="s2">                         First run isotype parsimony or refinement functions.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span> <span class="o">=</span> <span class="n">score</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.draw" class="doc doc-heading">
            <code class=" language-python"><span class="n">draw</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">isotype_encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hide_underscore</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color_encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.draw" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Visualization of the current B cell lineage tree saves as a png or pdf.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fname</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filename where the visualization should be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>isotype_encoding</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of the isotype labels to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>show_legend</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optionally display the legend of the isotype colors (default=True).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>show_labels</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>label the nodes by the sequence label</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hide_underscore</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>internal nodes that undergo refinement will have an underscore and copy number appended
to the label. Setting this to true hides the underscore during visualization and retains 
only the original label.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>color_encoding</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional dictionary that maps isotype encoding to a color, if None, the default
color palette is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dot</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if the file should be saved as a dot file, otherwise it will be saved
as a png or pdf, depending on the file exentsion of fname</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">fname</span><span class="p">,</span>
        <span class="n">isotype_encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">show_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">hide_underscore</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">color_encoding</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualization of the current B cell lineage tree saves as a png or pdf.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : str</span>
<span class="sd">        The filename where the visualization should be saved.  </span>
<span class="sd">    isotype_encoding : list</span>
<span class="sd">        The list of the isotype labels to use.  </span>
<span class="sd">    show_legend : bool</span>
<span class="sd">        Optionally display the legend of the isotype colors (default=True).  </span>
<span class="sd">    show_labels : bool</span>
<span class="sd">        label the nodes by the sequence label</span>
<span class="sd">    hide_underscore : bool</span>
<span class="sd">        internal nodes that undergo refinement will have an underscore and copy number appended</span>
<span class="sd">        to the label. Setting this to true hides the underscore during visualization and retains </span>
<span class="sd">        only the original label.</span>
<span class="sd">    color_encoding : dict, optional</span>
<span class="sd">        optional dictionary that maps isotype encoding to a color, if None, the default</span>
<span class="sd">        color palette is used.</span>
<span class="sd">    dot : bool</span>
<span class="sd">        if the file should be saved as a dot file, otherwise it will be saved</span>
<span class="sd">        as a png or pdf, depending on the file exentsion of fname</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parents</span><span class="p">()</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">DrawTree</span><span class="p">(</span><span class="n">parents</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span><span class="p">,</span>
                <span class="n">show_legend</span><span class="o">=</span><span class="n">show_legend</span><span class="p">,</span>
                <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
                <span class="n">isotype_encoding</span><span class="o">=</span><span class="n">isotype_encoding</span><span class="p">,</span>
                <span class="n">show_labels</span><span class="o">=</span><span class="n">show_labels</span><span class="p">,</span>
                <span class="n">hide_underscore</span><span class="o">=</span><span class="n">hide_underscore</span><span class="p">,</span>
                <span class="n">color_encoding</span><span class="o">=</span><span class="n">color_encoding</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dot</span><span class="p">:</span>
        <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dt</span><span class="o">.</span><span class="n">save_dot</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.get_edge_dataframe" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_edge_dataframe</span><span class="p">()</span></code>

<a href="#tribal.LineageTree.get_edge_dataframe" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Obtain the edge list of the lineage tree as a pandas.DataFrame.</p>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_edge_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Obtain the edge list of the lineage tree as a pandas.DataFrame.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">get_edge_df</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.get_id" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_id</span><span class="p">()</span></code>

<a href="#tribal.LineageTree.get_id" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Get the internal id of the tree topology. Useful for mapping refined trees back the to the unrefined tree in the parsimony forest.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the internal id of the tree topology</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the internal id of the tree topology. Useful for mapping refined trees back the to the unrefined tree in the parsimony forest.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    : int</span>
<span class="sd">        the internal id of the tree topology</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.get_leafs" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_leafs</span><span class="p">()</span></code>

<a href="#tribal.LineageTree.get_leafs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Identify the leafset of the lineage tree.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    the leafset of the lineage tree.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_leafs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Identify the leafset of the lineage tree.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        the leafset of the lineage tree.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">get_leafs</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.get_parents" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_parents</span><span class="p">()</span></code>

<a href="#tribal.LineageTree.get_parents" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Identify the part of each node in the lineage tree.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    a mapping of each node in the lineage tree to its parent node.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Identify the part of each node in the lineage tree.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        a mapping of each node in the lineage tree to its parent node.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">get_parents</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.is_leaf" class="doc doc-heading">
            <code class=" language-python"><span class="n">is_leaf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.is_leaf" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Check if node is a leaf.</p>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if node is a leaf.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.isotype_parsimony" class="doc doc-heading">
            <code class=" language-python"><span class="n">isotype_parsimony</span><span class="p">(</span><span class="n">isotype_labels</span><span class="p">,</span> <span class="n">transmat</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.isotype_parsimony" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Infer the isotype of the B cell lineage tree using weighted parsimony.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>isotype_labels</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary with leaf labels and root id as keys and isotypes as values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>transmat</code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the isotype transition probability used to compute the CSR likelihood.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Here is an example of how to infer isotypes::</p>
<div class="highlight"><pre><span></span><code>    <span class="kn">from</span> <span class="nn">tribal</span> <span class="kn">import</span> <span class="n">clonotypes</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">LineageTree</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;Clonotype_1036&quot;</span>
    <span class="n">clonotype</span> <span class="o">=</span> <span class="n">clonotypes</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
    <span class="n">forest</span> <span class="o">=</span> <span class="n">clonotype</span><span class="o">.</span><span class="n">get_forest</span><span class="p">()</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="n">LineageTree</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">forest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">csr_likelihood</span><span class="p">,</span> <span class="n">isotypes</span> <span class="o">=</span> <span class="n">lt</span><span class="o">.</span><span class="n">isotype_parsimony</span><span class="p">(</span><span class="n">isotype_labels</span><span class="o">=</span> <span class="n">clonotype</span><span class="o">.</span><span class="n">isotypes</span><span class="p">,</span>
                                                                <span class="n">transmat</span><span class="o">=</span><span class="n">probabilities</span> <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>
</code></pre></div>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>csr_obj</code></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a float with the class switch recombination likelihood score for the lineage tree.  </p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>isotypes</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary containing the isotypes of the lineage tree.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">isotype_parsimony</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isotype_labels</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">transmat</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Infer the isotype of the B cell lineage tree using weighted parsimony.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    isotype_labels : dict</span>
<span class="sd">        a dictionary with leaf labels and root id as keys and isotypes as values.  </span>
<span class="sd">    transmat : numpy.array</span>
<span class="sd">        the isotype transition probability used to compute the CSR likelihood.  </span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Here is an example of how to infer isotypes::</span>

<span class="sd">    ```python</span>
<span class="sd">        from tribal import clonotypes, probabilities, LineageTree</span>

<span class="sd">        id = &quot;Clonotype_1036&quot;</span>
<span class="sd">        clonotype = clonotypes[id]</span>
<span class="sd">        forest = clonotype.get_forest()</span>
<span class="sd">        lt = LineageTree(id=id, tree = forest[0] )</span>
<span class="sd">        csr_likelihood, isotypes = lt.isotype_parsimony(isotype_labels= clonotype.isotypes,</span>
<span class="sd">                                                                    transmat=probabilities )</span>
<span class="sd">        print(lt)</span>
<span class="sd">    ```</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    csr_obj : float</span>
<span class="sd">        a float with the class switch recombination likelihood score for the lineage tree.  </span>
<span class="sd">    isotypes : dict</span>
<span class="sd">        a dictionary containing the isotypes of the lineage tree.  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transmat</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">transmat</span><span class="p">)</span>
    <span class="n">states</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">transmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="n">SmallParsimony</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">alphabet</span><span class="o">=</span><span class="n">states</span><span class="p">,</span><span class="n">cost</span><span class="o">=</span><span class="n">transmat</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sankoff</span><span class="p">(</span><span class="n">isotype_labels</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.parent" class="doc doc-heading">
            <code class=" language-python"><span class="n">parent</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.parent" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Identify the parent of a specified node.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>n</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>id of query node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>   the parent of query node n.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Identify the parent of a specified node.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n: str | int</span>
<span class="sd">        id of query node.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">       the parent of query node n.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.postorder_traversal" class="doc doc-heading">
            <code class=" language-python"><span class="n">postorder_traversal</span><span class="p">()</span></code>

<a href="#tribal.LineageTree.postorder_traversal" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Perform a postorder traversal of the lineage tree.</p>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">postorder_traversal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform a postorder traversal of the lineage tree.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">postorder_traversal</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.preorder_traversal" class="doc doc-heading">
            <code class=" language-python"><span class="n">preorder_traversal</span><span class="p">()</span></code>

<a href="#tribal.LineageTree.preorder_traversal" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Perform a preorder traversal of the lineage tree.</p>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preorder_traversal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform a preorder traversal of the lineage tree.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">preorder_traversal</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.refinement" class="doc doc-heading">
            <code class=" language-python"><span class="n">refinement</span><span class="p">(</span><span class="n">isotype_labels</span><span class="p">,</span> <span class="n">transmat</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.refinement" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Solves the most parsimonious tree refinement problem (MPTR).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>isotype_labels</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with leaf labels and root id as keys and isotypes as values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>transmat</code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The isotype transition probability used to compute the CSR likelihood.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Here is an example of how to refine a lineage tree:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tribal</span> <span class="kn">import</span> <span class="n">clonotypes</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">LineageTree</span>

<span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;Clonotype_1036&quot;</span>
<span class="n">clonotype</span> <span class="o">=</span> <span class="n">clonotypes</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
<span class="n">forest</span> <span class="o">=</span> <span class="n">clonotype</span><span class="o">.</span><span class="n">get_forest</span><span class="p">()</span>
<span class="n">lt</span> <span class="o">=</span> <span class="n">LineageTree</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">tree</span><span class="o">=</span><span class="n">forest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">csr_likelihood</span><span class="p">,</span> <span class="n">isotypes</span> <span class="o">=</span> <span class="n">lt</span><span class="o">.</span><span class="n">refinement</span><span class="p">(</span><span class="n">isotype_labels</span><span class="o">=</span><span class="n">clonotype</span><span class="o">.</span><span class="n">isotypes</span><span class="p">,</span> <span class="n">transmat</span><span class="o">=</span><span class="n">probabilities</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>
</code></pre></div>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A float with the class switch recombination likelihood score for the lineage tree.  </p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the isotypes of the lineage tree.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">refinement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isotype_labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">transmat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Solves the most parsimonious tree refinement problem (MPTR).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    isotype_labels : dict</span>
<span class="sd">        A dictionary with leaf labels and root id as keys and isotypes as values.</span>
<span class="sd">    transmat : numpy.array</span>
<span class="sd">        The isotype transition probability used to compute the CSR likelihood.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Here is an example of how to refine a lineage tree:</span>

<span class="sd">    ```python</span>
<span class="sd">    from tribal import clonotypes, probabilities, LineageTree</span>

<span class="sd">    id = &quot;Clonotype_1036&quot;</span>
<span class="sd">    clonotype = clonotypes[id]</span>
<span class="sd">    forest = clonotype.get_forest()</span>
<span class="sd">    lt = LineageTree(id=id, tree=forest[0])</span>
<span class="sd">    csr_likelihood, isotypes = lt.refinement(isotype_labels=clonotype.isotypes, transmat=probabilities)</span>
<span class="sd">    print(lt)</span>
<span class="sd">    ```</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        A float with the class switch recombination likelihood score for the lineage tree.  </span>

<span class="sd">    dict</span>
<span class="sd">        A dictionary containing the isotypes of the lineage tree.  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">transmat</span><span class="p">)</span>
    <span class="n">cg</span> <span class="o">=</span> <span class="n">ConstructGraph</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">isotype_labels</span><span class="p">,</span> <span class="n">root_identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
    <span class="n">fg</span> <span class="o">=</span> <span class="n">cg</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">)</span>

    <span class="n">st</span> <span class="o">=</span> <span class="n">MPTR</span><span class="p">(</span><span class="n">fg</span><span class="o">.</span><span class="n">G</span><span class="p">,</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
              <span class="n">fg</span><span class="o">.</span><span class="n">find_terminals</span><span class="p">(),</span>
              <span class="n">fg</span><span class="o">.</span><span class="n">iso_weights</span><span class="p">,</span>
              <span class="n">fg</span><span class="o">.</span><span class="n">tree_to_graph</span><span class="p">,</span>
              <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span><span class="p">,</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span> <span class="o">=</span> <span class="n">cg</span><span class="o">.</span><span class="n">decodeTree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">BaseTree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">csr_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.save_edges" class="doc doc-heading">
            <code class=" language-python"><span class="n">save_edges</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.save_edges" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Write the edge list of a lineage tree to a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fname</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filename to where edge list should be saved</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the edge list of a lineage tree to a file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : str</span>
<span class="sd">        filename to where edge list should be saved </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">save_edges</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.save_tree" class="doc doc-heading">
            <code class=" language-python"><span class="n">save_tree</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.save_tree" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Write the parent dictionary of the lineage tree to a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fname</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filename where the file should be saved</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the parent dictionary of the lineage tree to a file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : str</span>
<span class="sd">        filename where the file should be saved </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parents</span><span class="p">()</span>
    <span class="n">save_dict</span><span class="p">(</span> <span class="n">parents</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.to_pickle" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_pickle</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.to_pickle" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Pickle the B cell lineage tree.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fname</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the path to where the pickled object should be saved,</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pickle the B cell lineage tree.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : str</span>
<span class="sd">        the path to where the pickled object should be saved,</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="tribal.LineageTree.write" class="doc doc-heading">
            <code class=" language-python"><span class="n">write</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="n">isotype_encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tree_label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tribal.LineageTree.write" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Write the lineage tree data to files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>outpath</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the path to file the files should be written.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>isotype_encoding</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the ordered isotype labels</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>tribal/lineage_tree.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outpath</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">isotype_encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tree_label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the lineage tree data to files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    outpath : str</span>
<span class="sd">        the path to file the files should be written.  </span>
<span class="sd">    isotype_encoding : list, optional</span>
<span class="sd">        the ordered isotype labels  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tree_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tree_label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tree_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tree_label</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">clono_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clonotype</span>
    <span class="k">if</span> <span class="n">isotype_encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">isotypes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">iso</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">iso</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">iso</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">isotype_encoding</span><span class="p">):</span>
                <span class="n">isotypes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">isotype_encoding</span><span class="p">[</span><span class="n">iso</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">isotypes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">iso</span>
        <span class="n">isotype_encoding</span> <span class="o">=</span> <span class="n">isotype_encoding</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">isotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotypes</span>
        <span class="n">isotype_encoding</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outpath</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outpath</span><span class="p">)</span>

    <span class="n">write_fasta</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outpath</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">clono_name</span><span class="si">}</span><span class="s2">_sequences</span><span class="si">{</span><span class="n">tree_label</span><span class="si">}</span><span class="s2">.fasta&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">)</span>
    <span class="n">save_dict</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outpath</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">clono_name</span><span class="si">}</span><span class="s2">_isotypes</span><span class="si">{</span><span class="n">tree_label</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span><span class="n">isotypes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_edges</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outpath</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">clono_name</span><span class="si">}</span><span class="s2">_edge_list</span><span class="si">{</span><span class="n">tree_label</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outpath</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">clono_name</span><span class="si">}</span><span class="s2">_tree</span><span class="si">{</span><span class="n">tree_label</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span>
                <span class="n">isotype_encoding</span><span class="o">=</span><span class="n">isotype_encoding</span><span class="p">,</span>
                <span class="n">hide_underscore</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">show_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "navigation.path", "toc.integrate", "toc.collapsible", "search.suggest", "search.highlight", "content.code.annotation", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>